<div class="container mb-4 h-100">
  <div class="row">
    <div class="col">
      <h2 class="mb-4">ショッピングカート</h2>
       <div class="float-right">
        <%= button_to 'カートを空にする', cart_items_path, method: :delete, data: {confirm: 'カートを空にして本当によろしいですか？'} %>
      </div>
      <%= flash[:alert] %>
      <table class="table">
        <thead>
          <tr>
            <th>商品名</th>
            <th>単価(税込)</th>
            <th>数量</th>
            <th>小計</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% sum = 0 %>
          <% @cart_items.each do |cart_item| %>
          <tr>
            <th>
              <%= attachment_image_tag cart_item.item, :image, size: '80x65', format: 'jpg' %>
              <%= cart_item.item.name %>
            </th>
            <th>
              <%= (cart_item.item.excluding_price*1.08).floor %>
            </th>
            <th>
              <%= form_with model: cart_item, url: cart_item_path(cart_item), method: :patch, local: true do |f| %>
              <%= f.select :amount, options_for_select(1..99), {include_blank: cart_item.amount.to_s} %>
              <%= f.submit "変更" %>
              <% end %>
            </th>
            <th>
              <%= ((cart_item.item.excluding_price*1.08)*(cart_item.amount)).floor %>
            </th>
            <th>
                <%= link_to " 削除する", cart_item_path(cart_item), method: :delete, local: true, data: {confirm: "#{cart_item.item.name}を削除してよろしいですか？"}, class: "glyphicon glyphicon-trash btn btn-danger" %>
            </th>
          </tr> 
          <% sum += (cart_item.item.excluding_price)*(cart_item.amount) %>
          <% end %>
        </tbody>
      </table>
      
      <%= link_to "買い物を続ける", root_path %> 
      <div class="text-right">
        合計金額
        <%= (sum*1.08).floor %>
      </div>
      <% unless @cart_items == [] %>
      <%= link_to "情報入力に進む", new_order_path, class: "float-right btn btn-outline-secondary" %>
      <% end %>
    </div><!--col-->
  </div><!--row-->
</div><!--container-->